version: 2

jobs:
   centos7:
     docker:
       - image: centos:7
     steps:
       - checkout
       - run:
          name: check build tools
          command: |
               yum install -y centos-release-scl
               yum-config-manager --enable rhel-server-rhscl-7-rpms
               yum install -y devtoolset-8
	       source ci_centos7_environment.sh
	       bash check_build_environment.sh || exit 1
	       cd $EXECDIR
       - run: 
          name: Install act dependencies
          command: |
              source ci_centos7_environment.sh
	      bash yale-asyncvlsi-act-dependencies.sh || exit 1
              cd $EXECDIR
       - run: 
          name: Install act
          command: |
              source ci_centos7_environment.sh
	      bash yale-asyncvlsi-act.sh || exit 1
              cd $EXECDIR
       - run: 
          name: Install act stdlib
          command: |
              source ci_centos7_environment.sh
	      bash yale-asyncvlsi-stdlib.sh || exit 1
              cd $EXECDIR
       - run: 
          name: Install rug dataflow classic lib
          command: |
              source ci_centos7_environment.sh
	      bash rug-bics-actlib_dataflow_neuro.sh || exit 1
              cd $EXECDIR
       - run: 
          name: Install expropt com (if availble)
          command: |
              source ci_centos7_environment.sh
	      bash yale-avlsi-expropt.sh || exit 1
              cd $EXECDIR
       - run: 
          name: Install expropt dependencies (if nessesary)
          command: |
              source ci_centos7_environment.sh
	      bash yale-asyncvlsi-expropt-dependencies.sh || exit 1
              cd $EXECDIR  
       - run: 
          name: Install expropt (if availble)
          command: |
              source ci_centos7_environment.sh
	      bash yale-asyncvlsi-expropt.sh || exit 1
              cd $EXECDIR   
       - run: 
          name: Install chp2prs
          command: |
              source ci_centos7_environment.sh
	      bash yale-asyncvlsi-chp2prs.sh || exit 1
              cd $EXECDIR
       - run: 
          name: Install interact
          command: |
              source ci_centos7_environment.sh
	      bash yale-asyncvlsi-interact.sh || exit 1
              cd $EXECDIR
       - run: 
          name: test act
          command: |
              source ci_centos7_environment.sh
	      bash yale-asyncvlsi-act-test.sh || exit 1
              cd $EXECDIR
       - run: 
          name: test chp2prs
          command: |
              source ci_centos7_environment.sh
	      bash yale-asyncvlsi-act-test.sh || exit 1
              cd $EXECDIR
              
# package and upload

workflows:
   version: 2
   build:
     jobs: 
        - centos7

